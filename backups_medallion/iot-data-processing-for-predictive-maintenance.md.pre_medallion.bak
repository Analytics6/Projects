# IoT Data Processing for Predictive Maintenance

Brief: Data processing pipelines for predictive maintenance solutions.

- Objectives:
  - Transform raw telemetry into features for ML models.
- Scope:
  - Streaming ingestion, feature extraction, labeling.
- Key Components:
  - Stream processors, feature pipelines, model inputs.
- Technologies:
  - Kafka, Spark/Structured Streaming, Databricks.
- Deliverables:
  - Feature datasets, model-ready artifacts, monitoring.

# Expanded Source Schemas, ER Diagrams, Facts & Dimensions

This standardized expansion provides five logical sources for the project and a canonical set of artifacts to be appended to project markdown files when a detailed schema is required.

NOTE: The artifacts below are design artifacts created for documentation and implementation planning. They are original work and may be used for internal design and implementation purposes.

Project-specific prefix: `iot_data_processing_for_predictive_maintenance` (derived from filename: `iot-data-processing-for-predictive-maintenance.md`).

---

### Source A: Ingest & Landing (Source: `iot_data_processing_for_predictive_maintenance_ingest`)

Tables (20):
1. iot_data_processing_for_predictive_maintenance_stg_raw
2. iot_data_processing_for_predictive_maintenance_raw_records
3. iot_data_processing_for_predictive_maintenance_dim_source_system
4. iot_data_processing_for_predictive_maintenance_dim_data_owner
5. iot_data_processing_for_predictive_maintenance_dim_file_type
6. iot_data_processing_for_predictive_maintenance_ref_file_schema
7. iot_data_processing_for_predictive_maintenance_fact_raw_events
8. iot_data_processing_for_predictive_maintenance_stage_enrichments
9. iot_data_processing_for_predictive_maintenance_dim_geo
10. iot_data_processing_for_predictive_maintenance_dim_business_unit
11. iot_data_processing_for_predictive_maintenance_audit_ingest
12. iot_data_processing_for_predictive_maintenance_dim_environment
13. iot_data_processing_for_predictive_maintenance_ref_parsing_errors
14. iot_data_processing_for_predictive_maintenance_stage_cdc
15. iot_data_processing_for_predictive_maintenance_dim_schema_version
16. iot_data_processing_for_predictive_maintenance_fact_event_counts
17. iot_data_processing_for_predictive_maintenance_audit_transforms
18. iot_data_processing_for_predictive_maintenance_stage_retries
19. iot_data_processing_for_predictive_maintenance_ref_mappings
20. iot_data_processing_for_predictive_maintenance_dim_status

ER Diagram (ASCII):

iot_data_processing_for_predictive_maintenance_fact_raw_events (event_id, source_system_id, record_key, payload_hash, event_ts)
  |-- source_system_id --> iot_data_processing_for_predictive_maintenance_dim_source_system(source_system_id)
  |-- record_key --> iot_data_processing_for_predictive_maintenance_raw_records(record_key)

Description: Ingest staging (immutable) → raw normalization → enrichment → audit. `iot_data_processing_for_predictive_maintenance_fact_raw_events` is used for throughput and source health monitoring.

---

### Source B: Operational Logs & Metrics (Source: `iot_data_processing_for_predictive_maintenance_ops`)

Tables (20):
1. iot_data_processing_for_predictive_maintenance_stg_ops_logs
2. iot_data_processing_for_predictive_maintenance_raw_ops
3. iot_data_processing_for_predictive_maintenance_dim_service
4. iot_data_processing_for_predictive_maintenance_dim_instance
5. iot_data_processing_for_predictive_maintenance_dim_log_level
6. iot_data_processing_for_predictive_maintenance_ref_error_codes
7. iot_data_processing_for_predictive_maintenance_fact_logs
8. iot_data_processing_for_predictive_maintenance_stage_alerts
9. iot_data_processing_for_predictive_maintenance_dim_team
10. iot_data_processing_for_predictive_maintenance_dim_region
11. iot_data_processing_for_predictive_maintenance_audit_ops_ingest
12. iot_data_processing_for_predictive_maintenance_ref_runbooks
13. iot_data_processing_for_predictive_maintenance_stage_incidents
14. iot_data_processing_for_predictive_maintenance_fact_incident_metrics
15. iot_data_processing_for_predictive_maintenance_dim_priority
16. iot_data_processing_for_predictive_maintenance_ref_maintenance_windows
17. iot_data_processing_for_predictive_maintenance_audit_recon
18. iot_data_processing_for_predictive_maintenance_stage_trimmed_logs
19. iot_data_processing_for_predictive_maintenance_ref_retention_policy
20. iot_data_processing_for_predictive_maintenance_dim_status

ER Diagram (ASCII):

iot_data_processing_for_predictive_maintenance_fact_logs (log_id, service_id, instance_id, log_level, message_ts)
  |-- service_id --> iot_data_processing_for_predictive_maintenance_dim_service(service_id)
  |-- instance_id --> iot_data_processing_for_predictive_maintenance_dim_instance(instance_id)

---

### Source C: Governance & Catalog (Source: `iot_data_processing_for_predictive_maintenance_gov`)

Tables (20):
1. iot_data_processing_for_predictive_maintenance_stg_catalog
2. iot_data_processing_for_predictive_maintenance_raw_catalog
3. iot_data_processing_for_predictive_maintenance_dim_dataset
4. iot_data_processing_for_predictive_maintenance_dim_owner
5. iot_data_processing_for_predictive_maintenance_dim_tag
6. iot_data_processing_for_predictive_maintenance_ref_policies
7. iot_data_processing_for_predictive_maintenance_fact_data_quality
8. iot_data_processing_for_predictive_maintenance_stage_lineage
9. iot_data_processing_for_predictive_maintenance_dim_classification
10. iot_data_processing_for_predictive_maintenance_dim_sensitivity
11. iot_data_processing_for_predictive_maintenance_audit_policies
12. iot_data_processing_for_predictive_maintenance_ref_sla
13. iot_data_processing_for_predictive_maintenance_stage_certifications
14. iot_data_processing_for_predictive_maintenance_fact_issues
15. iot_data_processing_for_predictive_maintenance_dim_remediation_team
16. iot_data_processing_for_predictive_maintenance_ref_controls
17. iot_data_processing_for_predictive_maintenance_audit_certification
18. iot_data_processing_for_predictive_maintenance_stage_policy_changes
19. iot_data_processing_for_predictive_maintenance_ref_standards
20. iot_data_processing_for_predictive_maintenance_dim_status

ER Diagram (ASCII):

iot_data_processing_for_predictive_maintenance_fact_data_quality (dq_id, dataset_id, check_name, check_status, checked_ts)
  |-- dataset_id --> iot_data_processing_for_predictive_maintenance_dim_dataset(dataset_id)

---

### Source D: Cost, Billing & Usage (Source: `iot_data_processing_for_predictive_maintenance_cost`)

Tables (20):
1. iot_data_processing_for_predictive_maintenance_stg_billing_records
2. iot_data_processing_for_predictive_maintenance_raw_billing
3. iot_data_processing_for_predictive_maintenance_dim_cost_center
4. iot_data_processing_for_predictive_maintenance_dim_resource_type
5. iot_data_processing_for_predictive_maintenance_dim_region
6. iot_data_processing_for_predictive_maintenance_ref_price_catalog
7. iot_data_processing_for_predictive_maintenance_fact_cost_usage
8. iot_data_processing_for_predictive_maintenance_stage_allocations
9. iot_data_processing_for_predictive_maintenance_dim_tagging
10. iot_data_processing_for_predictive_maintenance_dim_currency
11. iot_data_processing_for_predictive_maintenance_audit_billing_ingest
12. iot_data_processing_for_predictive_maintenance_ref_discounts
13. iot_data_processing_for_predictive_maintenance_stage_corrections
14. iot_data_processing_for_predictive_maintenance_fact_monthly_costs
15. iot_data_processing_for_predictive_maintenance_dim_billing_account
16. iot_data_processing_for_predictive_maintenance_ref_chargeback_rules
17. iot_data_processing_for_predictive_maintenance_audit_allocations
18. iot_data_processing_for_predictive_maintenance_stage_forecasts
19. iot_data_processing_for_predictive_maintenance_ref_rates
20. iot_data_processing_for_predictive_maintenance_dim_status

ER Diagram (ASCII):

iot_data_processing_for_predictive_maintenance_fact_cost_usage (usage_id, resource_id, cost_amount, currency, start_ts, end_ts)
  |-- resource_id --> iot_data_processing_for_predictive_maintenance_dim_resource_type(resource_id)
  |-- cost_center_id --> iot_data_processing_for_predictive_maintenance_dim_cost_center(cost_center_id)

---

### Source E: Canonical Transactions / Facts (Source: `iot_data_processing_for_predictive_maintenance_txn`)

Tables (20):
1. iot_data_processing_for_predictive_maintenance_stg_transactions
2. iot_data_processing_for_predictive_maintenance_raw_transactions
3. iot_data_processing_for_predictive_maintenance_dim_account
4. iot_data_processing_for_predictive_maintenance_dim_customer
5. iot_data_processing_for_predictive_maintenance_dim_product
6. iot_data_processing_for_predictive_maintenance_ref_exchange_rates
7. iot_data_processing_for_predictive_maintenance_fact_transactions
8. iot_data_processing_for_predictive_maintenance_stage_reconciliations
9. iot_data_processing_for_predictive_maintenance_dim_channel
10. iot_data_processing_for_predictive_maintenance_dim_merchant
11. iot_data_processing_for_predictive_maintenance_audit_txn_ingest
12. iot_data_processing_for_predictive_maintenance_ref_fee_schedule
13. iot_data_processing_for_predictive_maintenance_stage_settlements
14. iot_data_processing_for_predictive_maintenance_fact_settlements
15. iot_data_processing_for_predictive_maintenance_dim_status
16. iot_data_processing_for_predictive_maintenance_ref_limits
17. iot_data_processing_for_predictive_maintenance_audit_recon
18. iot_data_processing_for_predictive_maintenance_stage_adjustments
19. iot_data_processing_for_predictive_maintenance_fact_balance_snapshots
20. iot_data_processing_for_predictive_maintenance_dim_time

ER Diagram (ASCII):

iot_data_processing_for_predictive_maintenance_fact_transactions (transaction_id, account_id, amount, currency, txn_type, posted_ts)
  |-- account_id --> iot_data_processing_for_predictive_maintenance_dim_account(account_id)
  |-- customer_id --> iot_data_processing_for_predictive_maintenance_dim_customer(customer_id)
  |-- product_id --> iot_data_processing_for_predictive_maintenance_dim_product(product_id)

Common guidance:
- Always keep an immutable staging/raw zone for auditable ingestion.
- Use `audit_*` tables and checksums for reconciliation between source and target facts.
- Implement SCD patterns for dimensions where history is required.
- Register datasets in a data catalog and apply RBAC and PII protections as required.

## Detailed ER Diagram

# Detailed ER Diagram: Entities, Attributes, Relationships, Cardinalities

This detailed ER diagram template expands the ASCII ER stub into full entity descriptions, attribute lists, primary/foreign key definitions, and explicit relationships with cardinalities for the project prefix `iot_data_processing_for_predictive_maintenance` (source file `iot-data-processing-for-predictive-maintenance.md`).

The template covers a canonical canonical set of logical entities used across projects: Source/Stage/Raw, Dimension entities, Fact entities, Reference / Lookup tables, and Audit & Reconciliation tables.

---

**Entity: `iot_data_processing_for_predictive_maintenance_raw_records`**
- Purpose: Immutable raw ingest payload store (one row per source record).
- PK: `record_key`
- Key attributes: `record_key (PK)`, `source_system`, `raw_payload` (JSON), `ingest_ts`, `ingest_batch_id`, `payload_hash`.

**Entity: `iot_data_processing_for_predictive_maintenance_stg_<topic>`** (generic staging)
- Purpose: Parsed staging of a raw record specific to a topic (e.g. transactions, events).
- PK: `stg_id`
- Key attributes: `stg_id (PK)`, `record_key (FK -> iot_data_processing_for_predictive_maintenance_raw_records.record_key)`, `parsed_fields...`, `ingest_ts`, `batch_id`, `load_status`.

**Entity: `iot_data_processing_for_predictive_maintenance_dim_account`**
- Purpose: Account dimension used by transaction facts.
- PK: `account_id`
- Attributes: `account_id (PK)`, `customer_id`, `account_type`, `currency_code`, `open_date`, `close_date`, `status`, `valid_from`, `valid_to`.

**Entity: `iot_data_processing_for_predictive_maintenance_dim_customer`**
- Purpose: Customer master attributes and identity.
- PK: `customer_id`
- Attributes: `customer_id (PK)`, `first_name`, `last_name`, `email_hash`, `birth_date`, `kyc_level`, `country`, `risk_score`, `valid_from`, `valid_to`.

**Entity: `iot_data_processing_for_predictive_maintenance_dim_time`**
- Purpose: Standard time dimension for reporting.
- PK: `date_key`
- Attributes: `date_key (PK)`, `date`, `year`, `quarter`, `month`, `day`, `weekday`, `is_business_day`.

**Entity: `iot_data_processing_for_predictive_maintenance_dim_product`**
- Purpose: Product/SKU master for retail-like facts.
- PK: `product_id`
- Attributes: `product_id (PK)`, `sku`, `name`, `category`, `brand`, `size`, `color`, `status`, `valid_from`, `valid_to`.

**Entity: `iot_data_processing_for_predictive_maintenance_fact_transactions`**
- Purpose: Canonical transaction-level fact (grain: one event/transaction).
- PK: `transaction_id`
- Attributes: `transaction_id (PK)`, `source_event_id`, `account_id (FK)`, `customer_id (FK)`, `product_id (FK)`, `amount`, `currency_code`, `amount_usd`, `txn_type`, `channel_code`, `merchant_id`, `status`, `posted_ts`, `processed_ts`, `ingest_batch_id`, `checksum`.

---

Relationships and cardinalities (explicit):
- `iot_data_processing_for_predictive_maintenance_fact_transactions.account_id` (M:1) -> `iot_data_processing_for_predictive_maintenance_dim_account.account_id`
  - Cardinality: Many transactions map to one account.
- `iot_data_processing_for_predictive_maintenance_fact_transactions.customer_id` (M:1) -> `iot_data_processing_for_predictive_maintenance_dim_customer.customer_id`
  - Many transactions per customer; some transactions inferred to customer through account linkage.
- `iot_data_processing_for_predictive_maintenance_fact_transactions.product_id` (M:1) -> `iot_data_processing_for_predictive_maintenance_dim_product.product_id`
  - Many fact rows reference a single product row.
- `iot_data_processing_for_predictive_maintenance_fact_transactions.posted_ts` (M:1) -> `iot_data_processing_for_predictive_maintenance_dim_time.date_key` (via date_key derived from posted_ts)
  - Many transactions map to one date in the time dimension.
- `iot_data_processing_for_predictive_maintenance_stg_<topic>.record_key` (M:1) -> `iot_data_processing_for_predictive_maintenance_raw_records.record_key`
  - One staging row per raw record, after parsing.

Association tables / many-to-many patterns:
- If customers belong to segments or tags, model as `iot_data_processing_for_predictive_maintenance_rel_customer_segment(customer_id FK, segment_id FK, assigned_ts)` with PK composite (`customer_id`, `segment_id`).

Detailed ER rules & integrity constraints:
- Use FK constraints where possible in the curated warehouse (e.g., `FOREIGN KEY (account_id) REFERENCES iot_data_processing_for_predictive_maintenance_dim_account(account_id)`).
- Enforce uniqueness on natural keys (e.g., `transaction_id`, `account_id + source_event_id` as alternate key) and use checksums for content verification.
- Implement SCD2 pattern for dimensions needing history using `valid_from` and `valid_to` and a surrogate `dim_pk`.

Sample SQL DDL snippets (representative):

CREATE TABLE iot_data_processing_for_predictive_maintenance_dim_customer (
  customer_id STRING PRIMARY KEY,
  first_name STRING,
  last_name STRING,
  email_hash STRING,
  kyc_level STRING,
  risk_score DOUBLE,
  valid_from DATE,
  valid_to DATE
);

CREATE TABLE iot_data_processing_for_predictive_maintenance_fact_transactions (
  transaction_id STRING PRIMARY KEY,
  source_event_id STRING,
  account_id STRING,
  customer_id STRING,
  product_id STRING,
  amount DECIMAL(18,2),
  currency_code STRING,
  posted_ts TIMESTAMP,
  ingest_batch_id STRING,
  checksum STRING,
  FOREIGN KEY (account_id) REFERENCES iot_data_processing_for_predictive_maintenance_dim_account(account_id),
  FOREIGN KEY (customer_id) REFERENCES iot_data_processing_for_predictive_maintenance_dim_customer(customer_id)
);

ER Diagram (visual guidance):
- Center the `iot_data_processing_for_predictive_maintenance_fact_transactions` as the hub with outward links to `dim_account`, `dim_customer`, `dim_product`, and `dim_time`.
- Secondary facts (e.g., `iot_data_processing_for_predictive_maintenance_fact_settlements`) link back to `fact_transactions` via `transaction_id` where the settlement is child of a transaction (1:M relationship).

---

Per-project extension guidance:
- For banking projects, expand `dim_account` and `dim_customer` with regulatory attributes (aml_flags, kyc_date, tax_id_hash).
- For retail projects, extend `dim_product` with merchandising attributes and `dim_store` to represent brick-and-mortar locations.
- For IoT/telemetry projects, add time-series entity `iot_data_processing_for_predictive_maintenance_ts_measurements(device_id, measure_ts, metric, value)` with retention and rollup rules described.

This template is intended to be expanded with project-specific entities. The automation script will replace `iot_data_processing_for_predictive_maintenance` and `iot-data-processing-for-predictive-maintenance.md` and append the section to each markdown file that does not already contain a `## Detailed ER Diagram` marker.

